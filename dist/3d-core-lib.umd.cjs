(function(p,M){typeof exports=="object"&&typeof module<"u"?M(exports,require("three")):typeof define=="function"&&define.amd?define(["exports","three"],M):(p=typeof globalThis<"u"?globalThis:p||self,M(p["3d-core-lib"]={},p.THREE))})(this,function(p,M){"use strict";var ot=Object.defineProperty;var ut=(p,M,j)=>M in p?ot(p,M,{enumerable:!0,configurable:!0,writable:!0,value:j}):p[M]=j;var I=(p,M,j)=>ut(p,typeof M!="symbol"?M+"":M,j);var j=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},X={};/*! *****************************************************************************
	Copyright (C) Microsoft. All rights reserved.
	Licensed under the Apache License, Version 2.0 (the "License"); you may not use
	this file except in compliance with the License. You may obtain a copy of the
	License at http://www.apache.org/licenses/LICENSE-2.0

	THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
	KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
	WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
	MERCHANTABLITY OR NON-INFRINGEMENT.

	See the Apache Version 2.0 License for specific language governing permissions
	and limitations under the License.
	***************************************************************************** */var Q;function me(){if(Q)return X;Q=1;var c;return function(d){(function(h){var y=typeof globalThis=="object"?globalThis:typeof j=="object"?j:typeof self=="object"?self:typeof this=="object"?this:R(),m=T(d);typeof y.Reflect<"u"&&(m=T(y.Reflect,m)),h(m,y),typeof y.Reflect>"u"&&(y.Reflect=d);function T(D,G){return function(C,F){Object.defineProperty(D,C,{configurable:!0,writable:!0,value:F}),G&&G(C,F)}}function k(){try{return Function("return this;")()}catch{}}function E(){try{return(0,eval)("(function() { return this; })()")}catch{}}function R(){return k()||E()}})(function(h,y){var m=Object.prototype.hasOwnProperty,T=typeof Symbol=="function",k=T&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",E=T&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",R=typeof Object.create=="function",D={__proto__:[]}instanceof Array,G=!R&&!D,C={create:R?function(){return $(Object.create(null))}:D?function(){return $({__proto__:null})}:function(){return $({})},has:G?function(e,t){return m.call(e,t)}:function(e,t){return t in e},get:G?function(e,t){return m.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},F=Object.getPrototypeOf(Function),H=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:tt(),J=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:rt(),q=typeof WeakMap=="function"?WeakMap:nt(),U=T?Symbol.for("@reflect-metadata:registry"):void 0,V=Qe(),te=Ke(V);function De(e,t,r,n){if(s(r)){if(!ce(e))throw new TypeError;if(!de(t))throw new TypeError;return ze(e,t)}else{if(!ce(e))throw new TypeError;if(!b(t))throw new TypeError;if(!b(n)&&!s(n)&&!A(n))throw new TypeError;return A(n)&&(n=void 0),r=P(r),Je(e,t,r,n)}}h("decorate",De);function Ue(e,t){function r(n,f){if(!b(n))throw new TypeError;if(!s(f)&&!$e(f))throw new TypeError;ie(e,t,n,f)}return r}h("metadata",Ue);function Ae(e,t,r,n){if(!b(r))throw new TypeError;return s(n)||(n=P(n)),ie(e,t,r,n)}h("defineMetadata",Ae);function Ge(e,t,r){if(!b(t))throw new TypeError;return s(r)||(r=P(r)),re(e,t,r)}h("hasMetadata",Ge);function Fe(e,t,r){if(!b(t))throw new TypeError;return s(r)||(r=P(r)),Y(e,t,r)}h("hasOwnMetadata",Fe);function He(e,t,r){if(!b(t))throw new TypeError;return s(r)||(r=P(r)),ne(e,t,r)}h("getMetadata",He);function Le(e,t,r){if(!b(t))throw new TypeError;return s(r)||(r=P(r)),ae(e,t,r)}h("getOwnMetadata",Le);function xe(e,t){if(!b(e))throw new TypeError;return s(t)||(t=P(t)),oe(e,t)}h("getMetadataKeys",xe);function Ve(e,t){if(!b(e))throw new TypeError;return s(t)||(t=P(t)),ue(e,t)}h("getOwnMetadataKeys",Ve);function We(e,t,r){if(!b(t))throw new TypeError;if(s(r)||(r=P(r)),!b(t))throw new TypeError;s(r)||(r=P(r));var n=L(t,r,!1);return s(n)?!1:n.OrdinaryDeleteMetadata(e,t,r)}h("deleteMetadata",We);function ze(e,t){for(var r=e.length-1;r>=0;--r){var n=e[r],f=n(t);if(!s(f)&&!A(f)){if(!de(f))throw new TypeError;t=f}}return t}function Je(e,t,r,n){for(var f=e.length-1;f>=0;--f){var O=e[f],_=O(t,r,n);if(!s(_)&&!A(_)){if(!b(_))throw new TypeError;n=_}}return n}function re(e,t,r){var n=Y(e,t,r);if(n)return!0;var f=Z(t);return A(f)?!1:re(e,f,r)}function Y(e,t,r){var n=L(t,r,!1);return s(n)?!1:se(n.OrdinaryHasOwnMetadata(e,t,r))}function ne(e,t,r){var n=Y(e,t,r);if(n)return ae(e,t,r);var f=Z(t);if(!A(f))return ne(e,f,r)}function ae(e,t,r){var n=L(t,r,!1);if(!s(n))return n.OrdinaryGetOwnMetadata(e,t,r)}function ie(e,t,r,n){var f=L(r,n,!0);f.OrdinaryDefineOwnMetadata(e,t,r,n)}function oe(e,t){var r=ue(e,t),n=Z(e);if(n===null)return r;var f=oe(n,t);if(f.length<=0)return r;if(r.length<=0)return f;for(var O=new J,_=[],l=0,a=r;l<a.length;l++){var i=a[l],o=O.has(i);o||(O.add(i),_.push(i))}for(var u=0,v=f;u<v.length;u++){var i=v[u],o=O.has(i);o||(O.add(i),_.push(i))}return _}function ue(e,t){var r=L(e,t,!1);return r?r.OrdinaryOwnMetadataKeys(e,t):[]}function fe(e){if(e===null)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return e===null?1:6;default:return 6}}function s(e){return e===void 0}function A(e){return e===null}function qe(e){return typeof e=="symbol"}function b(e){return typeof e=="object"?e!==null:typeof e=="function"}function Ye(e,t){switch(fe(e)){case 0:return e;case 1:return e;case 2:return e;case 3:return e;case 4:return e;case 5:return e}var r="string",n=le(e,k);if(n!==void 0){var f=n.call(e,r);if(b(f))throw new TypeError;return f}return Ne(e)}function Ne(e,t){var r,n;{var f=e.toString;if(W(f)){var n=f.call(e);if(!b(n))return n}var r=e.valueOf;if(W(r)){var n=r.call(e);if(!b(n))return n}}throw new TypeError}function se(e){return!!e}function Ze(e){return""+e}function P(e){var t=Ye(e);return qe(t)?t:Ze(t)}function ce(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:Object.prototype.toString.call(e)==="[object Array]"}function W(e){return typeof e=="function"}function de(e){return typeof e=="function"}function $e(e){switch(fe(e)){case 3:return!0;case 4:return!0;default:return!1}}function N(e,t){return e===t||e!==e&&t!==t}function le(e,t){var r=e[t];if(r!=null){if(!W(r))throw new TypeError;return r}}function he(e){var t=le(e,E);if(!W(t))throw new TypeError;var r=t.call(e);if(!b(r))throw new TypeError;return r}function ve(e){return e.value}function ye(e){var t=e.next();return t.done?!1:t}function pe(e){var t=e.return;t&&t.call(e)}function Z(e){var t=Object.getPrototypeOf(e);if(typeof e!="function"||e===F||t!==F)return t;var r=e.prototype,n=r&&Object.getPrototypeOf(r);if(n==null||n===Object.prototype)return t;var f=n.constructor;return typeof f!="function"||f===e?t:f}function Xe(){var e;!s(U)&&typeof y.Reflect<"u"&&!(U in y.Reflect)&&typeof y.Reflect.defineMetadata=="function"&&(e=et(y.Reflect));var t,r,n,f=new q,O={registerProvider:_,getProvider:a,setProvider:o};return O;function _(u){if(!Object.isExtensible(O))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case e===u:break;case s(t):t=u;break;case t===u:break;case s(r):r=u;break;case r===u:break;default:n===void 0&&(n=new J),n.add(u);break}}function l(u,v){if(!s(t)){if(t.isProviderFor(u,v))return t;if(!s(r)){if(r.isProviderFor(u,v))return t;if(!s(n))for(var w=he(n);;){var g=ye(w);if(!g)return;var S=ve(g);if(S.isProviderFor(u,v))return pe(w),S}}}if(!s(e)&&e.isProviderFor(u,v))return e}function a(u,v){var w=f.get(u),g;return s(w)||(g=w.get(v)),s(g)&&(g=l(u,v),s(g)||(s(w)&&(w=new H,f.set(u,w)),w.set(v,g))),g}function i(u){if(s(u))throw new TypeError;return t===u||r===u||!s(n)&&n.has(u)}function o(u,v,w){if(!i(w))throw new Error("Metadata provider not registered.");var g=a(u,v);if(g!==w){if(!s(g))return!1;var S=f.get(u);s(S)&&(S=new H,f.set(u,S)),S.set(v,w)}return!0}}function Qe(){var e;return!s(U)&&b(y.Reflect)&&Object.isExtensible(y.Reflect)&&(e=y.Reflect[U]),s(e)&&(e=Xe()),!s(U)&&b(y.Reflect)&&Object.isExtensible(y.Reflect)&&Object.defineProperty(y.Reflect,U,{enumerable:!1,configurable:!1,writable:!1,value:e}),e}function Ke(e){var t=new q,r={isProviderFor:function(i,o){var u=t.get(i);return s(u)?!1:u.has(o)},OrdinaryDefineOwnMetadata:_,OrdinaryHasOwnMetadata:f,OrdinaryGetOwnMetadata:O,OrdinaryOwnMetadataKeys:l,OrdinaryDeleteMetadata:a};return V.registerProvider(r),r;function n(i,o,u){var v=t.get(i),w=!1;if(s(v)){if(!u)return;v=new H,t.set(i,v),w=!0}var g=v.get(o);if(s(g)){if(!u)return;if(g=new H,v.set(o,g),!e.setProvider(i,o,r))throw v.delete(o),w&&t.delete(i),new Error("Wrong provider for target.")}return g}function f(i,o,u){var v=n(o,u,!1);return s(v)?!1:se(v.has(i))}function O(i,o,u){var v=n(o,u,!1);if(!s(v))return v.get(i)}function _(i,o,u,v){var w=n(u,v,!0);w.set(i,o)}function l(i,o){var u=[],v=n(i,o,!1);if(s(v))return u;for(var w=v.keys(),g=he(w),S=0;;){var we=ye(g);if(!we)return u.length=S,u;var at=ve(we);try{u[S]=at}catch(it){try{pe(g)}finally{throw it}}S++}}function a(i,o,u){var v=n(o,u,!1);if(s(v)||!v.delete(i))return!1;if(v.size===0){var w=t.get(o);s(w)||(w.delete(u),w.size===0&&t.delete(w))}return!0}}function et(e){var t=e.defineMetadata,r=e.hasOwnMetadata,n=e.getOwnMetadata,f=e.getOwnMetadataKeys,O=e.deleteMetadata,_=new q,l={isProviderFor:function(a,i){var o=_.get(a);return!s(o)&&o.has(i)?!0:f(a,i).length?(s(o)&&(o=new J,_.set(a,o)),o.add(i),!0):!1},OrdinaryDefineOwnMetadata:t,OrdinaryHasOwnMetadata:r,OrdinaryGetOwnMetadata:n,OrdinaryOwnMetadataKeys:f,OrdinaryDeleteMetadata:O};return l}function L(e,t,r){var n=V.getProvider(e,t);if(!s(n))return n;if(r){if(V.setProvider(e,t,te))return te;throw new Error("Illegal state.")}}function tt(){var e={},t=[],r=function(){function l(a,i,o){this._index=0,this._keys=a,this._values=i,this._selector=o}return l.prototype["@@iterator"]=function(){return this},l.prototype[E]=function(){return this},l.prototype.next=function(){var a=this._index;if(a>=0&&a<this._keys.length){var i=this._selector(this._keys[a],this._values[a]);return a+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:i,done:!1}}return{value:void 0,done:!0}},l.prototype.throw=function(a){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),a},l.prototype.return=function(a){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:a,done:!0}},l}(),n=function(){function l(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(l.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),l.prototype.has=function(a){return this._find(a,!1)>=0},l.prototype.get=function(a){var i=this._find(a,!1);return i>=0?this._values[i]:void 0},l.prototype.set=function(a,i){var o=this._find(a,!0);return this._values[o]=i,this},l.prototype.delete=function(a){var i=this._find(a,!1);if(i>=0){for(var o=this._keys.length,u=i+1;u<o;u++)this._keys[u-1]=this._keys[u],this._values[u-1]=this._values[u];return this._keys.length--,this._values.length--,N(a,this._cacheKey)&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},l.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},l.prototype.keys=function(){return new r(this._keys,this._values,f)},l.prototype.values=function(){return new r(this._keys,this._values,O)},l.prototype.entries=function(){return new r(this._keys,this._values,_)},l.prototype["@@iterator"]=function(){return this.entries()},l.prototype[E]=function(){return this.entries()},l.prototype._find=function(a,i){if(!N(this._cacheKey,a)){this._cacheIndex=-1;for(var o=0;o<this._keys.length;o++)if(N(this._keys[o],a)){this._cacheIndex=o;break}}return this._cacheIndex<0&&i&&(this._cacheIndex=this._keys.length,this._keys.push(a),this._values.push(void 0)),this._cacheIndex},l}();return n;function f(l,a){return l}function O(l,a){return a}function _(l,a){return[l,a]}}function rt(){var e=function(){function t(){this._map=new H}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(r){return this._map.has(r)},t.prototype.add=function(r){return this._map.set(r,r),this},t.prototype.delete=function(r){return this._map.delete(r)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.keys()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[E]=function(){return this.keys()},t}();return e}function nt(){var e=16,t=C.create(),r=n();return function(){function a(){this._key=n()}return a.prototype.has=function(i){var o=f(i,!1);return o!==void 0?C.has(o,this._key):!1},a.prototype.get=function(i){var o=f(i,!1);return o!==void 0?C.get(o,this._key):void 0},a.prototype.set=function(i,o){var u=f(i,!0);return u[this._key]=o,this},a.prototype.delete=function(i){var o=f(i,!1);return o!==void 0?delete o[this._key]:!1},a.prototype.clear=function(){this._key=n()},a}();function n(){var a;do a="@@WeakMap@@"+l();while(C.has(t,a));return t[a]=!0,a}function f(a,i){if(!m.call(a,r)){if(!i)return;Object.defineProperty(a,r,{value:C.create()})}return a[r]}function O(a,i){for(var o=0;o<i;++o)a[o]=Math.random()*255|0;return a}function _(a){if(typeof Uint8Array=="function"){var i=new Uint8Array(a);return typeof crypto<"u"?crypto.getRandomValues(i):typeof msCrypto<"u"?msCrypto.getRandomValues(i):O(i,a),i}return O(new Array(a),a)}function l(){var a=_(e);a[6]=a[6]&79|64,a[8]=a[8]&191|128;for(var i="",o=0;o<e;++o){var u=a[o];(o===4||o===6||o===8)&&(i+="-"),u<16&&(i+="0"),i+=u.toString(16).toLowerCase()}return i}}function $(e){return e.__=void 0,delete e.__,e}})}(c||(c={})),X}me();let ge=0;function be(){return ge++}var K;(function(c){c[c.MultipleBindingsAvailable=2]="MultipleBindingsAvailable",c[c.NoBindingsAvailable=0]="NoBindingsAvailable",c[c.OnlyOneBindingAvailable=1]="OnlyOneBindingAvailable"})(K||(K={}));var ee;(function(c){c.DynamicValue="toDynamicValue",c.Factory="toFactory",c.Provider="toProvider"})(ee||(ee={}));class _e{constructor(d){I(this,"id");I(this,"registry");this.id=be(),this.registry=d}}const z={BaseOpt:Symbol.for("BaseOpt"),CommonDebugOpt:Symbol.for("CommonDebugOpt"),ThreeJsBase:Symbol.for("ThreeJsBase"),LoadUpdateHandler:Symbol.for("LoadUpdateHandler"),UpdateHandler:Symbol.for("UpdateHandler"),Update:Symbol.for("Update"),LoaderUpdate:Symbol.for("LoaderUpdate"),LoaderReset:Symbol.for("LoaderReset"),GUI:Symbol.for("GUI")};function Me(c,d="./gameConfig.json"){return new _e(async h=>{const m=(await Oe(d)).baseOpt;h(z.BaseOpt).toConstantValue(m);const T=new M.WebGLRenderer({canvas:c,antialias:m.antialias,powerPreference:"high-performance"});T.setSize(window.innerWidth,window.innerHeight),T.outputColorSpace=m.colorSpace,T.setPixelRatio(Math.min(window.devicePixelRatio,2));const k={renderer:T,scene:new M.Scene,camera:new M.PerspectiveCamera(m.camera.fov,window.innerWidth/window.innerHeight,m.camera.near,m.camera.far)};h(z.ThreeJsBase).toConstantValue(k)})}async function Oe(c){try{const d=await fetch(c);if(!d.ok)throw new Error(`Response status: ${d.status}`);return await d.json()}catch(d){console.error(d.message)}}const B=class B{static async task(d){return new Promise(h=>{B.resolvers.set(this._idCounter++,{ms:d/1e3,resolver:h})})}static update(d){B.resolvers.forEach((h,y)=>{h.ms-=d,h.ms<=0&&(h.resolver(),B.resolvers.delete(y))})}};I(B,"_idCounter",0),I(B,"resolvers",new Map);let x=B;class Te{constructor(d,h,y,m=0){I(this,"deltaTime",0);I(this,"clock",new M.Clock);this.threeJSBase=d,this.commonDebugOpt=h,this.updatables=y,this.allPassedTime=m}get getDeltaTime(){return this.deltaTime}handleUpdate(){this.deltaTime=this.clock.getDelta()*this.commonDebugOpt.timeScale,this.allPassedTime+=this.deltaTime,x.update(this.deltaTime),this.updatables.forEach(d=>{d.update(this.deltaTime,this.threeJSBase.camera)})}}function ke(c,d){const h=c.folders.find(y=>y._title===d);if(!h)throw new Error(`Folder with name ${d} not found`);return h}function Ee(c,d,h,y="XYZ"){const m=c.toArray(),T=d.toArray(),k=m.map((E,R)=>E+(T[R]-E)*h);return new M.Euler(k[0],k[1],k[2],y)}async function Se(c){return new Promise(d=>{setTimeout(()=>{d()},c)})}function Pe(c,d){const h=c.frames.find(R=>R.filename.toLowerCase()===d.toLowerCase());if(!h)throw new Error(`Frame with id ${d} not found in atlas config`);const{x:y,y:m,h:T}=h.frame,{size:k}=c.meta,E=m/k.h;return new M.Vector2(y/k.w,E)}function Re(c){return c.x*c.x+c.y*c.y+c.z*c.z}function Ce(c,d,h,y,m){return(c-d)/(h-d)*(m-y)+y}class Ie{constructor(...d){I(this,"args");this.args=d}}function je(c,d){const h=y=>{d(...y.detail)};return document.addEventListener(c.name,h,{passive:!0}),{unsubscribe:()=>document.removeEventListener(c.name,h)}}function Be(c){const d=new CustomEvent(c.constructor.name,{detail:c.args});document.dispatchEvent(d)}p.BASETYPES=z,p.BaseUpdateHandler=Te,p.EventBase=Ie,p.TaskManager=x,p.buildBaseDIModule=Me,p.findGUIFolder=ke,p.getLengthVector=Re,p.getSpriteOffset=Pe,p.lerpingRotation=Ee,p.mapRange=Ce,p.publish=Be,p.sleep=Se,p.subscribe=je,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});
